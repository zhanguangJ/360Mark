"use strict";function toTop(){600<=(document.body.scrollTop||document.documentElement.scrollTop)?$(".toback").css("display","block"):$(".toback").css("display","none"),$(".toback").click(function(){var n=window.setInterval(function(){var a=window.pageYOffset;0<a?window.scrollTo(0,a-1):window.clearInterval(n)},30)}),$("#pageBtnWrap").click(function(){var n=window.setInterval(function(){var a=window.pageYOffset;0<a?window.scrollTo(0,a-3):window.clearInterval(n)},30)})}var isOk1=!1,isOK2=!1,isOk3=!1,isOK4=!1,isOk5=!1,phone="",password="";function draw(a){var n=$("#canvas").width(),t=$("#canvas").height(),e=document.getElementById("canvas"),s=e.getContext("2d");e.width=n,e.height=t;for(var i="A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0,z,x,c,v,b,n,m,a,s,d,f,g,h,j,k,l,q,w,e,r,t,y,u,i,o,p".split(","),c=i.length,o=0;o<=3;o++){var l=Math.floor(Math.random()*c),r=30*Math.random()*Math.PI/180,p=i[l];a[o]=p.toLowerCase();var d=10+20*o,u=20+8*Math.random();s.font="bold 23px 微软雅黑",s.translate(d,u),s.rotate(r),s.fillStyle=randomColor(),s.fillText(p,0,0),s.rotate(-r),s.translate(-d,-u)}for(o=0;o<=5;o++)s.strokeStyle=randomColor(),s.beginPath(),s.moveTo(Math.random()*n,Math.random()*t),s.lineTo(Math.random()*n,Math.random()*t),s.stroke();for(o=0;o<=30;o++){s.strokeStyle=randomColor(),s.beginPath();d=Math.random()*n,u=Math.random()*t;s.moveTo(d,u),s.lineTo(d+1,u+1),s.stroke()}}function randomColor(){return"rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"}function loginResgin(){$("#login").click(function(){$(".quc-login").css("display","block"),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","block")}),$(".tip-login").click(function(){$(".quc-login").css("display","block"),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","block")}),$(".quc-left").click(function(){$(".quc-login").css("display","none"),$(".quc-mask").css("display","block"),setTimeout(function(){$(".quc-panel-large").css("display","block")},50)}),$(".gInfoBtn-addcart").click(function(){$(".quc-login").css("display","block"),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","block")}),$(".favorite").click(function(){$(".quc-login").css("display","block"),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","block")}),$(".list-item").on("click",".add-cart",function(){$(".quc-login").css("display","block"),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","block")}),$(".quc-icon-close").click(function(){$(".quc-login").css("display","none"),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","none")}),$("#resgin").click(function(){$(".quc-login").css("display","none"),$(".quc-mask").css("display","block"),$(".quc-panel-large").css("display","block"),$(".quc-input-append").css("display","block")}),$(".Direct-login").click(function(){console.log(111),setTimeout(function(){$(".quc-login").css("display","block")},50),$(".quc-panel-large").css("display","none"),$(".quc-mask").css("display","block")}),$(".quc-tab-list").on("click","div",function(){$(this).addClass("quc-tab-item-active"),$(this).siblings("div").removeClass("quc-tab-item-active"),$(this).children().html()?($(".quc-mobile>input").attr("type","mobile").attr("placeholder","验证码次数不够所以没做请切换到账号登录").attr("maxlength","11"),$(".quc-psw>input").attr("type","smscode").attr("placeholder","短信验证码"),$(".quc-input-append").css("display","block")):($(".quc-mobile>input").attr("type","userName").attr("placeholder","手机号/用户名/邮箱/试用账号123456"),$(".quc-psw>input").attr("type","password").attr("placeholder","密码/密码123456"),$(".quc-input-append").css("display","none"))})}$(function(){var t=[];draw(t),$("#canvas").on("click",function(){draw(t)}),$(".change").on("click",function(){draw(t)}),$("#input-val").on("blur",function(){var a=$("#input-val").val().toLowerCase(),n=t.join("");""==a?$(".output2").html("请输入验证码！").css("color","red").css("fontSize","12px"):a==n?($(".output2").html("验证码正确").css("color","#58bc58").css("fontSize","12px"),isOK2=!0,$(".input-val").val("")):($(".output2").html("验证码错误！请重新输入！").css("color","red").css("fontSize","12px"),$("#input-val").val(""),draw(t))})}),loginResgin(),$(".phoneRegister").children("div").eq(0).children("input").on("keyup",function(){(phone=$(this).val())?/^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/.test(phone)?$.ajax({type:"get",url:"src/api/login.php",data:{phone:phone,time:new Date},success:function(a){1!=JSON.parse(a).result1?($(".phoneRegister").children("div").eq(0).children("input").next().html("验证通过").css({color:"#58bc58",fontSize:"12px"}),isOk1=!0):$(".phoneRegister").children("div").eq(0).children("input").next().html("该手机号已经注册，请直接用手机号登录").css({color:"red",fontSize:"12px"})}}):($(this).next().html("手机号码格式不正确").css({color:"red",fontSize:"12px"}),isOk1=!1):$(this).next().html("请填写手机号码").css({color:"red",fontSize:"12px"})});var validCode=!0;function loginOf(a){$(".loginbefore").css("display","none"),$(".loginafter").css("display","block"),$(".quc-login").css("display","none"),$(".quc-mask").css("display","none"),$(".cart-tips").css("display","none"),$(".cart-info").css("display","block"),setCookie("username",a,1),uName()}function uName(){var a=getCookie("username");$html1='<span class="top-uname popUsername">\n                            '+a+'\n                        </span>\n            <div class="popbox">\n                <a href="javascript:;" class="top-uname popUsername">'+a+'</a>\n                <ul class="topuserbox" >\n                    <li>\n                        <a href="javascript:;">我的订单</a>\n                    </li>\n                    <li>\n                        <a href="javascript:;">我的优惠券</a>\n                    </li>\n                    <li>\n                        <a href="javascript:;">我的喜欢</a>\n                    </li>\n                    <li>\n                        <a href="javascript:;">我的积分</a>\n                    </li>\n                    <li>\n                        <a href="javascript:;">收货地址</a>\n                    </li>\n                    <li>\n                        <a href="javascript:;">账号设置</a>\n                    </li>\n                    <li class="quit">\n                        <a href="javascript:;">退出登录</a>\n                    </li>\n                </ul>\n            </div>',$(".loginWrap").html($html1)}function ssCart(){var e=getCookie("username");new Promise(function(n){$.ajax({type:"get",url:"/360Mark/src/api/order.php",data:{username:e,time:new Date},success:function(a){n(a)}})}).then(function(a){var n=a.replace(/\}(.+?)\{/g,"},{");n||(n="{"+n+"}");var t=JSON.parse(n);t.length?$html=t.map(function(a){return'<li class="cart-item" data-id="'+a.id+'">\n                            <a href="javascript:;">\n                                <img src="/360Mark/src/img/'+a.title+a.bigimg+'.jpg">\n                                    <span class="cart-item-text">\n                                        <strong>'+a.name+'</strong>\n                                    </span>\n                            </a>\n                            <span class="cart-item-price">\n                                <span class="yen">¥</span>\n                                '+a.price+".00\n                            </span>\n                            \n                        </li>"}).join(""):$html="快去购买商品吧",$(".cart-list").html($html),$.ajax({type:"get",url:"/360Mark/src/api/showcart.php",data:{username:e,time:new Date},success:function(a){for(var n=JSON.parse(a),t=0;t<n.length;t++)$ht='<span class="cart-item-num"> ×'+n[t].num+'</span>\n                            <a class="cart-item-del" href="javascript:;"></a>',$(".cart-item").eq(t).append($ht)}})}).then(function(){$.ajax({type:"get",url:"/360Mark/src/api/shopcart.php",data:{data:1,username:e,time:new Date},success:function(a){var t=JSON.parse(a)[0]["sum(num)"];$.ajax({type:"get",url:"/360Mark/src/api/shopcart.php",data:{data:2,username:e,time:new Date},success:function(a){if(0==$(".cart-list").children("li").size())$html=' <span>\n                                    共<b class="cartNum">0</b>\n                                    件商品 总计：\n                                    <b>\n                                        <span class="yen">￥</span>\n                                        0\n                                    </b>\n                                </span>\n                                <a href="/360Mark/src/html/cart.html" class="cart-buy">去购物车</a>';else{var n=JSON.parse(a)[0]["sum(totalprice)"];$html=' <span>\n                                    共<b class="cartNum">'+t+'</b>\n                                    件商品 总计：\n                                    <b>\n                                        <span class="yen">￥</span>\n                                        '+n+'\n                                    </b>\n                                </span>\n                                <a href="/360Mark/src/html/cart.html" class="cart-buy">去购物车</a>'}$(".cart-count").html($html)}})}})})}function undateStatus(){var a=getCookie("username");a?(ssCart(),$(".quc-panel-large").css("display","none"),$(".loginbefore").css("display","none"),$(".loginafter").css("display","block"),$(".cart-tips").css("display","none"),$(".cart-info").css("display","block"),$(".topNavMyOrder").css("display","block"),$(".popUsername").html(a),$(".gInfoBtn-addcart").click(function(){var a=getCookie("username"),n=decodeURI(location.search).split("?")[1],t=$(".ng-pristine").val();$.ajax({type:"get",url:"/360Mark/src/api/cart.php",data:{username:a,goodsId:n,num1:t,time:new Date},success:function(a){1==a&&ssCart()}})}),$(".favorite").click(function(){console.log(222)}),$(".list-item").on("click",".add-cart",function(){var a=getCookie("username"),n=$(this).parent().attr("data-id");$.ajax({type:"get",url:"/360Mark/src/api/cart.php",data:{username:a,goodsId:n,time:new Date},success:function(a){1==a?(alert("成功加入购物车"),ssCart()):alert("加入购物车失败")}})}),$.ajax({type:"get",url:"/360Mark/src/api/shopcart.php",data:{data:1,username:a,time:new Date},success:function(a){JSON.parse(a)[0]["sum(num)"]}})):($(".loginbefore").css("display","block"),$(".loginafter").css("display","none"),$(".cart-tips").css("display","block"),$(".cart-info").css("display","none"),$(".topNavMyOrder").css("display","none"),loginResgin())}function quit(){$(".quit").click(function(){getCookie("username");removeCookie("username"),$(".loginbefore").css("display","block"),$(".loginafter").css("display","none"),$(".cart-tips").css("display","block"),$(".cart-info").css("display","none"),window.location.href="/360Mark/index.html"})}function setCookie(a,n,t){var e=new Date;e.setDate(e.getDate()+t),document.cookie=a+"="+n+";expires="+e+";path=/"}function getCookie(a){var n=document.cookie.split("; "),t=!0,e=!1,s=void 0;try{for(var i,c=n[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var o=i.value.split("=");if(a==o[0])return o[1]}}catch(a){e=!0,s=a}finally{try{!t&&c.return&&c.return()}finally{if(e)throw s}}}function removeCookie(a){setCookie(a,"",-2)}$(".quc-input-append").click(function(){var a=$(this).parent().prev().prev().children("input").val();$(this).prev().prev().val();if(""!=a){isOk3=!0;var n=10,t=$(this);if(validCode){validCode=!1,t.addClass("msgs1"),t.css("color","#818080"),$.ajax({type:"post",url:"/360Mark/src/api/duanxin.php",data:{userphone:a},success:function(a){var n=JSON.parse(a);$("#SMS").on("blur",function(){var a=$("#SMS").val();n.phonecode==a?(isOk3=!0,$(".phoneRegister").children("div").eq(2).children("div").eq(1).next().html("验证通过").css({color:"#58bc58",fontSize:"12px"})):$(".phoneRegister").children("div").eq(2).children("div").eq(1).next().html("验证码错误！请重新输入！").css({color:"red",fontSize:"12px"})})}});var e=setInterval(function(){n--,t.html(n+"秒"),0==n&&(clearInterval(e),t.html("重新获取"),t.css("color","#58bc58"),validCode=!0,t.removeClass("msgs1"))},1e3)}}else alert("请先输入手机号码")}),$(".phoneRegister").children("div").eq(3).children("input").on("blur",function(){(password=$(this).val())?8<=password.length?/^(?![A-Z]+$)(?![a-z]+$)(?!\d+$)(?![\W_]+$)\S+$/.test(password)?($(this).next().html(""),isOk4=!0):$(this).next().html("至少包含数字/字母/字符两种组合，请重新输入").css({color:"red",fontSize:"12px"}):$(this).next().html("密码不能少于8位字符，请重新输入").css({color:"red",fontSize:"12px"}):$(this).next().html("请填写密码").css({color:"red",fontSize:"12px"})}),$(".phoneRegister").children("div").eq(4).find("input").on("blur",function(){isOk5=!!$(this).is(":checked")}),$(".phoneRegister").children("div").eq(5).children("input").on("click",function(){isOk1&&isOK2&&isOk3&&isOk4&&isOk5?($.ajax({type:"post",url:"src/api/register.php",data:{phone:phone,password:password,time:new Date},success:function(a){console.log(a)}}),alert("成功注册,点击确定后跳转首页"),$(".quc-panel-large").css("display","none"),$(".topNavMyOrder").css("display","block"),loginOf(phone),ssCart()):alert("请填写完整的信息")}),$(".log-in").children("div").eq(2).children("input").click(function(){var n=$(".log-in").children("div").eq(0).children("input").val().trim(),a=$(".log-in").children("div").eq(1).children("input").val().trim();$.ajax({type:"post",url:"/360Mark/src/api/login.php",data:{phoneLogin:n,pswLogin:a,time:new Date},success:function(a){1==JSON.parse(a).result2?(loginOf(n),location.reload(!0)):alert("账号或密码错误")}})}),uName(),undateStatus(),quit(),$(".cart-list").on("click",".cart-item-del",function(){var a=getCookie("username"),n=$(this).parent("li").attr("data-id");$.ajax({type:"get",url:"/360Mark/src/api/delete.php",data:{username:a,gid:n,time:new Date},success:function(a){1==a?ssCart():alert("删除失败")}})}),$(".topfrist").on("click",function(){window.open("/360Mark/src/html/list.html")}),$(".navbar").on("click","li",function(){if($(this).attr("data-name")){var a=$(this).attr("data-name");window.open("/360Mark/src/html/list.html?"+a)}}),$(".searchKey").on("click","a",function(){var a=$(this).attr("data-id");window.open("/360Mark/src/html/details.html?"+a)}),$("h1").click(function(){window.open("/360Mark/index.html")});